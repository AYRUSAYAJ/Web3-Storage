<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Array Input Page</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 50px;
        }
    </style>
</head>
<body>

    <label for="arrayInput">Enter an array (comma-separated):</label>
    <input type="text" id="arrayInput" placeholder="e.g., 1, 2, 3">

    <br><br>

    <button id="confirmButton">Confirm</button>

    <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js/dist/web3.min.js"></script>
    <script type="module">
    
        async function processArray() {
            const arrayInput = document.getElementById('arrayInput').value;
            const filesToDelete = arrayInput.split(',').map(item => item.trim());

            const contractABI =[
  {
    "type": "function",
    "name": "addFile",
    "inputs": [
      {
        "type": "string",
        "name": "_fileName",
        "internalType": "string"
      },
      {
        "type": "string",
        "name": "_fileCID",
        "internalType": "string"
      }
    ],
    "outputs": [],
    "stateMutability": "nonpayable"
  },
  {
    "type": "function",
    "name": "deleteFile",
    "inputs": [
      {
        "type": "uint256",
        "name": "index",
        "internalType": "uint256"
      }
    ],
    "outputs": [],
    "stateMutability": "nonpayable"
  },
  {
    "type": "function",
    "name": "files",
    "inputs": [
      {
        "type": "uint256",
        "name": "",
        "internalType": "uint256"
      }
    ],
    "outputs": [
      {
        "type": "string",
        "name": "fileName",
        "internalType": "string"
      },
      {
        "type": "string",
        "name": "fileCID",
        "internalType": "string"
      },
      {
        "type": "address",
        "name": "owner",
        "internalType": "address"
      }
    ],
    "stateMutability": "view"
  },
  {
    "type": "function",
    "name": "getFile",
    "inputs": [
      {
        "type": "uint256",
        "name": "index",
        "internalType": "uint256"
      }
    ],
    "outputs": [
      {
        "type": "string",
        "name": "",
        "internalType": "string"
      },
      {
        "type": "string",
        "name": "",
        "internalType": "string"
      },
      {
        "type": "address",
        "name": "",
        "internalType": "address"
      }
    ],
    "stateMutability": "view"
  },
  {
    "type": "function",
    "name": "getFileCID",
    "inputs": [
      {
        "type": "uint256",
        "name": "index",
        "internalType": "uint256"
      }
    ],
    "outputs": [
      {
        "type": "string",
        "name": "",
        "internalType": "string"
      }
    ],
    "stateMutability": "view"
  },
  {
    "type": "function",
    "name": "getFileCount",
    "inputs": [],
    "outputs": [
      {
        "type": "uint256",
        "name": "",
        "internalType": "uint256"
      }
    ],
    "stateMutability": "view"
  },
  {
    "type": "function",
    "name": "getFileName",
    "inputs": [
      {
        "type": "uint256",
        "name": "index",
        "internalType": "uint256"
      }
    ],
    "outputs": [
      {
        "type": "string",
        "name": "",
        "internalType": "string"
      }
    ],
    "stateMutability": "view"
  },
  {
    "type": "function",
    "name": "getFileOwner",
    "inputs": [
      {
        "type": "uint256",
        "name": "index",
        "internalType": "uint256"
      }
    ],
    "outputs": [
      {
        "type": "address",
        "name": "",
        "internalType": "address"
      }
    ],
    "stateMutability": "view"
  }
]; 
            const contractAddress = '0xf99Ca96ECd9678F31caf5d34DFeF1A03A390cF06'; 
            try {
            
                await window.ethereum.request({ method: 'eth_requestAccounts' });

                const web3 = new Web3(window.ethereum);
                const accounts = await web3.eth.getAccounts();
                const userWalletAddress = accounts[0];

                
                const contract = new web3.eth.Contract(contractABI, contractAddress);

                
                filesToDelete.forEach(index => {
                    contract.methods.deleteFile(index)
                        .send({ from: userWalletAddress })
                        .on('transactionHash', (hash) => {
                              alert(`Delete transaction sent. Transaction Hash: ${hash}`);
                        })
                        .on('confirmation', (confirmationNumber, receipt) => {
                            if (confirmationNumber === 1) {
                                alert(`File at index ${index} deleted successfully.`);
                            }
                        })
                        .on('error', (error) => {
                            alert(`Error deleting file at index ${index}: ${error.message}`);
                        });
                });
                window.location.href = '/dashboard';
            } catch (error) {
                console.error('Error:', error.message);
            }
        }

        document.getElementById('confirmButton').addEventListener('click', processArray);

    </script>

</body>
</html>
